{% extends 'lectura/base.html' %}

{% block title %}Metas | Gestor de Lecturas{% endblock %}

{% block content %}
<h1>Mis Metas</h1>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn">Crear meta</button>
</form>
<hr>
<h2>Progreso de tus metas</h2>
<ul>
    {% for p in progreso %}
        <li style="display: flex; align-items: center; justify-content: space-between; gap: 10px;">
            <div>
                <strong>{{ p.meta.nombre }}</strong> ({{ p.meta.tipo }})<br>
                <span style="font-size:0.95em; color:#888;">Creada por: {{ p.meta.creador.nombre|default_if_none:'-' }}</span><br>
                Fecha límite: {{ p.meta.fecha_fin }}<br>
                {% if p.objetivo_libros %}
                    Libros leídos: {{ p.libros_leidos }} / {{ p.objetivo_libros }}
                    {% if p.libros_leidos|add:'0' >= p.objetivo_libros|add:'0' %}
                        <span style="display:inline-block;background:#22c55e;color:#fff;font-size:0.95em;padding:2px 10px;border-radius:12px;margin-left:8px;vertical-align:middle;">
                            &#x2714; ¡Meta completada!
                        </span>
                    {% endif %}<br>
                {% else %}
                    Libros leídos: {{ p.libros_leidos }} / {{ p.total_libros }}<br>
                {% endif %}
                <span style="color:#0ea5e9;font-size:1em;font-weight:600;">Progreso: {{ p.porcentaje }}%</span>
                {% if p.objetivo_notas %}
                    <ul>
                    {% for libro, notas in p.notas_por_libro.items %}
                        <li>Notas en <strong>{{ libro }}</strong>: {{ notas }} / {{ p.objetivo_notas }}</li>
                    {% endfor %}
                    </ul>
                {% endif %}
            </div>
            {% if p.meta.creador == user or user.is_superuser or user.is_staff %}
                <a href="{% url 'metas:editar_meta' p.meta.id %}" class="btn" style="margin-left:10px; white-space:nowrap;">Editar</a>
            {% endif %}
        </li>
    {% empty %}
        <li>No tienes metas registradas.</li>
    {% endfor %}
</ul>
{% endblock %}
